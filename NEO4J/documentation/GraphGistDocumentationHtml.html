<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 1.5.4">
  <meta name="author" content="By: Daniel Finca Martínez &amp; Óscar Sánchez Campo">
  <title>Neo4j Teamwork complementary documentation</title>
  <link rel="stylesheet" href="https://asciidoclive.com/assets/asciidoctor.js/css/asciidoctor.css">
</head>

<body class="article">
  <div id="header">
    <h1>Neo4j Teamwork complementary documentation</h1>
    <div class="details">
      <span id="author" class="author">By: Daniel Finca Martínez &amp; Óscar Sánchez Campo</span><br>
    </div>
  </div>
  <div id="content">
    <div id="preamble">
      <div class="sectionbody">
        <div class="paragraph">
          <p>GraphGist created to complement the main documentation of this graph databases
            teamwork using Neo4j.</p>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_graph_creation_script">Graph creation script</h2>
      <div class="sectionbody">
        <div class="listingblock">
          <div class="content">
            <pre class="highlight"><code class="language-cypher" data-lang="cypher">CREATE
  (mieres:Village {name:'Mieres', inhabitants: 38428}),
  (gijon:City {name:'Gijón', inhabitants: 271843}),
  (aviles:City {name:'Aviles', inhabitants: 78715}),
  (siero:City {name:'Pola de Siero', inhabitants: 51662}),
  (pravia:Village {name:'Pravia', inhabitants: 8282}),
  (grado:Village {name:'Grado', inhabitants: 9839}),
  (narcea:Village {name:'Cangas de Narcea', inhabitants: 12579}),
  (turon:Valley {name:'Turón', inhabitants: 3617}),
  (onis:City {name:'Cangas de Onís', inhabitants: 6278}),
  (ribadesella:Village {name:'Ribadesella', inhabitants: 5730}),
  (nava:Village {name:'Nava', inhabitants: 5334}),
  (castrillon:City {name:'Piedras Blancas', inhabitants: 22464}),
  (lena:Village {name:'Pola de Lena', inhabitants: 8682}),
  (llanera:City {name:'Lugo de Llanera', inhabitants: 13676}),
  (moreda:Village {name:'Moreda de Aller', inhabitants: 2765}),
  (llanes:Village {name:'Llanes', inhabitants: 13639}),
  (colombres:Village {name:'Colombres', inhabitants: 500}),
  (vegadeo:Village {name:'Vegadeo', inhabitants: 3866}),
  (navia:Village {name:'Navia', inhabitants: 8409}),
  (langreo:City {name:'Langreo', inhabitants: 39984}),
  (smra:City {name:'El Entrego', inhabitants: 16283}),
  (laviana:City {name:'Laviana', inhabitants: 13087}),
  (candas:City {name: 'Candás', inhabitants: 7150}),
  (cudillero:City {name: 'Cudillero', inhabitants: 5078}),
  (luarca:City {name: 'Luarca', inhabitants: 5292}),
  (oviedo:City {name: 'Oviedo', inhabitants: 220020})
CREATE
  (lena)-[:RAILWAY {line:"C1", price: 1, avg_ride_time: 10}]-&gt;(mieres),
  (mieres)-[:RAILWAY {line:"C1", price: 2, avg_ride_time: 20}]-&gt;(oviedo),
  (oviedo)-[:RAILWAY {line:"C1", price: 0.7, avg_ride_time: 12}]-&gt;(llanera),
  (llanera)-[:RAILWAY {line:"C1", price: 1.4, avg_ride_time: 20}]-&gt;(gijon),
  (oviedo)-[:RAILWAY {line:"C2", price: 2, avg_ride_time: 20}]-&gt;(langreo),
  (langreo)-[:RAILWAY {line:"C2", price: 0.5, avg_ride_time: 5}]-&gt;(smra),
  (oviedo)-[:RAILWAY {line:"C3", price: 0.7, avg_ride_time: 12}]-&gt;(llanera),
  (mieres)-[:RAILWAY {line:"F8", price: 1.6, avg_ride_time: 20 }]-&gt;(moreda),
  (oviedo)-[:RAILWAY {line:"F7", price: 1.6, avg_ride_time: 20}]-&gt;(grado),
  (grado)-[:RAILWAY {line:"F7", price: 1.6, avg_ride_time: 20}]-&gt;(pravia),
  (gijon)-[:RAILWAY {line:"F4", price: 2, avg_ride_time: 25}]-&gt;(aviles),
  (aviles)-[:RAILWAY {line:"F4", price: 1.5, avg_ride_time: 15}]-&gt;(castrillon),
  (castrillon)-[:RAILWAY {line:"F4", price: 1.5, avg_ride_time: 15}]-&gt;(pravia),
  (pravia)-[:RAILWAY {line:"F4", price: 1.5, avg_ride_time: 15}]-&gt;(cudillero),
  (cudillero)-[:RAILWAY {line:"F4", price: 5, avg_ride_time: 50}]-&gt;(luarca),
  (luarca)-[:RAILWAY {line:"F4", price: 4, avg_ride_time: 30}]-&gt;(navia),
  (navia)-[:RAILWAY {line:"F4", price: 4, avg_ride_time: 40}]-&gt;(vegadeo),
  (gijon)-[:RAILWAY {line:"F5", price: 2, avg_ride_time: 20}]-&gt;(siero),
  (siero)-[:RAILWAY {line:"F5", price: 2, avg_ride_time: 20}]-&gt;(langreo),
  (langreo)-[:RAILWAY {line:"F5", price: 0.5, avg_ride_time: 8}]-&gt;(smra),
  (smra)-[:RAILWAY {line:"F5", price: 0.5, avg_ride_time: 10}]-&gt;(laviana),
  (oviedo)-[:RAILWAY {line:"F6", price: 1, avg_ride_time: 15}]-&gt;(siero),
  (siero)-[:RAILWAY {line:"F6", price: 2, avg_ride_time: 20}]-&gt;(nava),
  (nava)-[:RAILWAY {line:"F6", price: 2, avg_ride_time: 20}]-&gt;(ribadesella),
  (ribadesella)-[:RAILWAY {line:"F6", price: 2.5, avg_ride_time: 30}]-&gt;(llanes),
  (llanes)-[:RAILWAY {line:"F6", price: 4, avg_ride_time: 40}]-&gt;(colombres),
  (lena)-[:BUSLINE {price: 1, avg_ride_time: 30}]-&gt;(mieres),
  (mieres)-[:BUSLINE {price: 1.5, avg_ride_time: 30}]-&gt;(oviedo),
  (mieres)-[:BUSLINE {price: 1.3, avg_ride_time: 15}]-&gt;(turon),
  (mieres)-[:BUSLINE {price: 2, avg_ride_time: 30}]-&gt;(langreo),
  (oviedo)-[:BUSLINE {price: 1.5, avg_ride_time: 20}]-&gt;(gijon),
  (oviedo)-[:BUSLINE {price: 1.8, avg_ride_time: 35}]-&gt;(aviles),
  (gijon)-[:BUSLINE {price: 1.8, avg_ride_time: 25}]-&gt;(aviles),
  (oviedo)-[:BUSLINE {price: 3, avg_ride_time: 60}]-&gt;(llanes),
  (mieres)-[:BUSLINE {price: 2, avg_ride_time: 20}]-&gt;(moreda),
  (oviedo)-[:BUSLINE {price: 5, avg_ride_time: 70}]-&gt;(narcea),
  (lena)-[:HIGHWAY {avg_ride_time: 10}]-&gt;(mieres),
  (mieres)-[:HIGHWAY {avg_ride_time: 15}]-&gt;(oviedo),
  (siero)-[:HIGHWAY {avg_ride_time: 12}]-&gt;(gijon),
  (oviedo)-[:HIGHWAY {avg_ride_time: 20}]-&gt;(gijon),
  (gijon)-[:HIGHWAY {avg_ride_time: 20}]-&gt;(aviles),
  (oviedo)-[:HIGHWAY {avg_ride_time: 20}]-&gt;(aviles),
  (mieres)-[:HIGHWAY {avg_ride_time: 13}]-&gt;(siero),
  (oviedo)-[:HIGHWAY {avg_ride_time: 15}]-&gt;(grado),
  (aviles)-[:HIGHWAY {avg_ride_time: 5}]-&gt;(castrillon),
  (castrillon)-[:HIGHWAY {avg_ride_time: 10}]-&gt;(cudillero),
  (cudillero)-[:HIGHWAY {avg_ride_time: 25}]-&gt;(luarca),
  (luarca)-[:HIGHWAY {avg_ride_time: 30}]-&gt;(navia),
  (siero)-[:HIGHWAY {avg_ride_time: 30}]-&gt;(ribadesella),
  (ribadesella)-[:HIGHWAY {avg_ride_time: 20}]-&gt;(llanes),
  (llanes)-[:HIGHWAY {avg_ride_time: 20}]-&gt;(colombres),
  (gijon)-[:HIGHWAY {avg_ride_time: 30}]-&gt;(llanes),
  (candas)-[:BOAT {avg_ride_time: 20, price: 3.50}]-&gt;(gijon),
  (candas)-[:BOAT {avg_ride_time: 20, price: 2.50}]-&gt;(luarca),
  (gijon)-[:BOAT {avg_ride_time: 20, price: 1.50}]-&gt;(candas),
  (navia)-[:BOAT {avg_ride_time: 20, price: 2}]-&gt;(cudillero),
  (luarca)-[:BOAT {avg_ride_time: 20, price: 4}]-&gt;(gijon),
  (cudillero)-[:BOAT {avg_ride_time: 20, price: 2.34}]-&gt;(candas),
  (oviedo)-[:BUSLINE {price: 4.5, avg_ride_time: 60}]-&gt;(onis)</code></pre>
          </div>
        </div>
      </div>
    </div>
    <h1 id="_queries" class="sect0">Queries</h1>
    <div class="sect1">
      <h2 id="_beginner">Beginner</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="_first">First</h3>
          <div class="paragraph">
            <p><em>Return all cities that have over 10000 inhabitants ordered by number of inhabitants</em></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-cypher" data-lang="cypher">  MATCH (n:City)
  WHERE n.inhabitants &gt; 10000
  RETURN n.name
  ORDER BY n.inhabitants DESC</code></pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_second">Second</h3>
          <div class="paragraph">
            <p><em>Returns all nodes that have a Railway with line C1</em></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-cypher" data-lang="cypher">  MATCH (n)-[r:RAILWAY]-&gt;(o)
	WHERE r.line ="C1"
	RETURN n.name, r.avg_ride_time,r.price, o.name</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_intermediate">Intermediate</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="_first_2">First</h3>
          <div class="paragraph">
            <p><em>Return the ratio between price and time spent on every public transport line. In the case of busline and boat there is no lane, hence the cost is represented as a whole. Order by type of public transport and by line name</em></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-cypher" data-lang="cypher">  MATCH (n)-[r:RAILWAY|:BOAT|:BUSLINE]-(v)
  WHERE r.avg_ride_time &gt; 19
  RETURN type(r), r.line, avg(r.price)/avg(r.avg_ride_time) as euros_per_minute_linewise
	ORDER BY euros_per_minute_linewise DESC
  LIMIT 25</code></pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_second_2">Second</h3>
          <div class="paragraph">
            <p><em>Return the Railway-traversed paths between two adjacent nodes of the same lime whose price is higher than the average price of their line. Return the name of start and end nodes, as well as the average ride time of each path, the line and its price. Also return the average price of such line.</em></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-cypher" data-lang="cypher">  MATCH (n)-[r1:RAILWAY]-(m)
  WITH r1.line as line
  MATCH (a)-[r:RAILWAY]-(b)
  WHERE r.line = line
  WITH avg(r.price) as average, line as line
  MATCH (a)-[r:RAILWAY]-(b)
  WHERE (r.price) &gt; average AND r.line = line
  RETURN a.name,r.avg_ride_time,r.line,r.price,b.name,average
  LIMIT 25</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="_advanced">Advanced</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="_first_3">First</h3>
          <div class="paragraph">
            <p><em>Return the shortest path (including each of the nodes) in between Gijón and Pola de Lena, along with the total trip time and the amount paid</em></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-cypher" data-lang="cypher">  MATCH shortestPath((a)-[c:BUSLINE|:RAILWAY|:BOAT*]-(b))
  WHERE a.name='Pola de Lena' and b.name='Gijón'
  RETURN reduce (var=0,v1 in c | var+v1.avg_ride_time) as Total_Time, reduce(var = 0, v1 in c | var + v1.price) as Total_Price, c as Relationships,extract(x in c|startnode(x)) as InitialNodes,extract(x in c|endnode(x)) as EndNodes
  LIMIT 25</code></pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_second_3">Second</h3>
          <div class="paragraph">
            <p><em>From every possible path between any node that is adjacent to Langreo by train and communicated with a Valley in 1 to 3 steps through any conveyance means, return the departure node, the nodes in the path and the relationships traversed. The first node must start with a vowel</em></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-cypher" data-lang="cypher">  MATCH path = (n)-[r1:RAILWAY]-(l)-[r2*1..3]-(t:Valley)
  WHERE l.name='Langreo' AND n.name =~ "[aeiouAEIOU].*"
  RETURN n, nodes(path), relationships(path)
  LIMIT 25</code></pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>